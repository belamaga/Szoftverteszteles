<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <title>6.13. &#8222;√°tver√©s &#8211; oldalakon kereszt√ºli k√©relem hamis√≠t√°s&#8221; (Spoofing - Cross-Site Request Forgery (CSRF))</title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="Szoftvertesztel√©s"><link rel="up" href="ch06.html" title="6. fejezet - Biztons√°gi tesztel√©s"><link rel="prev" href="ch06s12.html" title="6.12. &#8222;Szimatol√≥ t√°mad√°s &#8211; H√°l√≥zati Lehallgat√°s&#8221; (Sniffing Attacks - Network Eavesdropping)"><link rel="next" href="ch07.html" title="7. fejezet - Teszt menedzsment"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">6.13. 
      
            &#8222;√°tver√©s &#8211; oldalakon kereszt√ºli k√©relem hamis√≠t√°s&#8221; (Spoofing - Cross-Site Request Forgery (CSRF))</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch06s12.html">El&#337;z&#337;</a>&nbsp;</td><th width="60%" align="center">6. fejezet - Biztons√°gi tesztel√©s</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch07.html">K√∂vetkez&#337;</a></td></tr></table><hr></div><div class="sect1" title="6.13. &#8222;√°tver√©s &#8211; oldalakon kereszt√ºli k√©relem hamis√≠t√°s&#8221; (Spoofing - Cross-Site Request Forgery (CSRF))"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e3912"></a>6.13. 
      
            <a name="Overview4"></a>&#8222;√°tver√©s &#8211; oldalakon kereszt√ºli k√©relem hamis√≠t√°s&#8221; (Spoofing - Cross-Site Request Forgery (CSRF))</h2></div></div></div><div class="sect2" title="6.13.1. √°ttekint√©s"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3917"></a>6.13.1. 
      
               <a name="_Toc291181685"></a>√°ttekint√©s</h3></div></div></div><p>A &#8222;CSRF&#8221; egy olyan t√°mad√°s, ami arra k√©nyszer√≠ti a felhaszn√°l√≥t, hogy olyan tev√©kenys√©get v√©gezzen egy webes alkalmaz√°sban, amibe √©ppen be van jelentkezve, amit nem √°llna sz√°nd√©k√°ban megtenni. Egy kis &#8222;szocializ√°ci√≥s m√©rn√∂k√∂sk√∂d√©ssel&#8221; (p√©ld√°ul hivatkoz√°s k√ºld√©se e-mailen vagy chat-en kereszt√ºl) a t√°mad√≥ arra k√©nyszer√≠ti a felhaszn√°l√≥t, hogy olyan cselekedeteket hajtson v√©gre, amiket a behatol√≥ szeretne. Egy mezei felhaszn√°l√≥ eset√©ben egy sikeres CSRF t√°mad√°s vesz√©lybe sodorhatja a felhaszn√°l√≥ adatait √©s tev√©kenys√©g√©t. Ha a t√°mad√°ssal megc√©lzott azonos√≠t√≥ egy adminisztr√°torhoz tartozik, akkor egy ilyen behatol√°s az eg√©sz webes alkalmaz√°s biztons√°g√°t vesz√©lyezteti.</p></div><div class="sect2" title="6.13.2. Vonatkoz√≥ biztons√°gi int√©zked√©sek"><div class="titlepage"><div><div><h3 class="title"><a name="d0e3924"></a>6.13.2. 
      
               <a name="Related_Security_Activities4"></a>Vonatkoz√≥ biztons√°gi int√©zked√©sek</h3></div></div></div><div class="sect3" title="6.13.2.1. Hogyan n√©zz√ºnk √°t egy k√≥dot CSRF sebezhet&#337;s√©get keresve?"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3929"></a>6.13.2.1. 
      
                  <a name="How_to_Review_Code_for_CSRF_Vulnerabilit"></a>Hogyan n√©zz√ºnk √°t egy k√≥dot CSRF sebezhet&#337;s√©get keresve?</h4></div></div></div><p>A <a class="ulink" href="http://www.owasp.org/index.php/Category:OWASP_Code_Review_Project" target="_top">OWASP Code Review Guide</a> cikkben olvashatunk arr√≥l, hogy hogyan n√©zz√ºnk √°t egy k√≥dot CSRF sebezhet&#337;s√©g rem√©ny√©ben (<a class="ulink" href="http://www.owasp.org/index.php/Reviewing_code_for_Cross-Site_Request_Forgery_issues" target="_top">Reviewing code for CSRF</a>).</p></div><div class="sect3" title="6.13.2.2. Hogyan tesztelj√ºk a CSRF sebezhet&#337;s√©get?"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3942"></a>6.13.2.2. 
      
                  <a name="How_to_Test_for_CSRF_Vulnerabilities2"></a>Hogyan tesztelj√ºk a CSRF sebezhet&#337;s√©get?</h4></div></div></div><p>A <a class="ulink" href="http://www.owasp.org/index.php/Category:OWASP_Testing_Project" target="_top">OWASP Testing Guide</a> cikkben olvashatunk arr√≥l, hogy hogyan tesztelj√ºk a CSRF sebezhet&#337;s√©get (<a class="ulink" href="http://www.owasp.org/index.php/Testing_for_CSRF_(OWASP-SM-005)" target="_top">Test for CSRF</a>).</p></div><div class="sect3" title="6.13.2.3. Hogyan el&#337;zz√ºk meg a CSRF sebezhet&#337;s√©get?"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3955"></a>6.13.2.3. 
      
                  <a name="How_to_Prevent_CSRF_Vulnerabilites2"></a>Hogyan el&#337;zz√ºk meg a CSRF sebezhet&#337;s√©get?</h4></div></div></div><p>A <a class="ulink" href="http://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet" target="_top">OWASP CSRF Prevention Cheat Sheet</a> dokumentumban olvashatunk a sebezhet&#337;s√©g megel&#337;z√©s√©r&#337;l.</p><p>Halgassuk meg a k√∂vetkez&#337; felv√©telt: <a class="ulink" href="http://www.owasp.org/download/jmanico/owasp_podcast_69.mp3" target="_top">OWASP Top Ten CSRF Podcast</a>.</p><p>Egy kiv√°l√≥ √≠r√°s John Melton toll√°b√≥l arr√≥l, hogy hogyan haszn√°ljuk az <a class="ulink" href="http://www.owasp.org/index.php/Category:OWASP_Enterprise_Security_API" target="_top">OWASP ESAPI</a> be√©p√≠tett anti-CSRF funkci√≥j√°t: <a class="ulink" href="http://www.jtmelton.com/2010/05/16/the-owasp-top-ten-and-esapi-part-6-cross-site-request-forgery-csrf/" target="_top">excellent blog post</a>
   
               </p></div><div class="sect3" title="6.13.2.4. Le√≠r√°s"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3978"></a>6.13.2.4. 
      
                  <a name="Description29"></a>Le√≠r√°s</h4></div></div></div><p>Az &#8222;oldalakon kereszt√ºli k√©relem hamis√≠t√°s&#8221; (CSRF) egy olyan t√°mad√°s, ami tr√ºkk√∂s m√≥don r√°veszi az √°ldozatot, hogy olyan weboldalt nyisson meg, ami k√°ros k√©relmet tartalmaz. Ez olyan √©rtelemben k√°ros, hogy √∂r√∂kli az √°ldozat szem√©lyazonoss√°g√°t √©s privil√©giumait √©s ezekkel felszerelve az √°ldozat nev√©ben nem k√≠v√°nt tev√©kenys√©get v√©gez, mint p√©ld√°ul megv√°ltoztatja az e-mail c√≠met, a lak√°sc√≠met, a k√ºl√∂nf√©le jelszavakat vagy √©ppen v√°s√°rol valamit. A CSRF t√°mad√°sok √°ltal√°ban olyan funkci√≥kat c√©loznak, amelyek valamilyen √°llapotv√°ltoz√°st id√©znek el&#337; a szerveren, de ezzel egy id&#337;ben k√©nyes inform√°ci√≥kat is megszerez.</p><p>A legt√∂bb oldalon a b√∂ng√©sz&#337;k automatikusan t√°rolj√°k a legt√∂bb ilyesfajta k√©relmet, ami b√°rmilyen, a weboldalhoz tartoz√≥ igazol√≥ adatot tartalmaz, mint p√©ld√°ul a felhaszn√°l√≥ session cookie-j√°t, alapvet&#337; bejelentkez√©si adatait, IP c√≠m√©t, Windows domain adatait, stb. √≠gy ha a felhaszn√°l√≥ √©ppen be van jelentkezve az oldalra, akkor az oldalnak es√©lye sincs a hamis k√©relmet megk√ºl√∂nb√∂ztetni a a val√≥di felhaszn√°l√≥i k√©relemt&#337;l.</p><p>Ez √∫ton a t√°mad√≥ √∫gy int√©zheti, hogy az √°ldozat olyasmit csin√°ljon, amit nem akart volna, p√©ld√°ul kijelentkezhet, v√°s√°rolhat valamit, hozz√°f√©r√©si inform√°ci√≥kat v√°ltoztathat meg, hozz√°f√©r√©si inform√°ci√≥kat szerezhet vissza vagy b√°rmi egy√©b, a s√©r√ºl√©keny weboldal √°ltal k√≠n√°lt funkci√≥kat hajthat v√©gre.</p><p>N√©ha lehet&#337;s√©g van arra, hogy a CSRF t√°mad√°st mag√°n a s√©r√ºl√©keny weboldalon t√°roljuk. Az ilyen sebezhet&#337;s√©geket T√°rolt CSRF hib√°nak (Stored CSRF flaw) nevezz√ºk. Ezt egyszer&#369;en el lehet √©rni √∫gy, hogy egy IMG vagy IFRAME tag-et t√°rolunk egy olyan mez&#337;ben, ami elfogadja a HTML-t, de haszn√°lhatunk j√≥val komplexebb kereszt-oldali szkriptel&#337; t√°mad√°st is. Ha a t√°mad√°s k√©pes t√°rolni egy CSRF t√°mad√°st az oldalon, akkor a behatol√°s s√∫lyoss√°ga megn&#337;. Val√≥j√°ban nagyobb annak a val√≥sz√≠n&#369;s√©ge, hogy az √°ldozat a t√°mad√°st tartalmaz√≥ lapot n√©zi, mint egy m√°sik, v√©letlenszer&#369;en kiv√°lasztott lapot az interneten. A val√≥sz√≠n&#369;s√©g az√©rt is n&#337;, mert az √°ldozat m√°r biztosan be van jelentkezve az oldalra.</p><p>Szinon√≠m√°k: a CSRF t√°mad√°sok sok m√°s n√©ven is ismerik, mint p√©ld√°ul: XSRF, "Sea Surf", Session Riding, Cross-Site Reference Forgery vagy &nbsp;Hostile Linking. A Microsoft &#8222;Egykattint√°sos&#8221; t√°mad√°sk√©nt (One-Click attack) hivatkozik erre a a fajta t√°mad√°sra a fenyegetl√©s modellez&#337; folyamat√°ban √©s sok m√°s helyen az online dokument√°ci√≥kban.</p></div><div class="sect3" title="6.13.2.5. Megel&#337;z√©si m√≥dszerek, amik NEM M&#368;K÷DNEK"><div class="titlepage"><div><div><h4 class="title"><a name="d0e3993"></a>6.13.2.5. 
      
                  <a name="__RefHeading__17940_1902038280"></a>
      
                  <a name="_Toc291181691"></a>
      
                  <a name="Prevention_measures_that_do_NOT_work2"></a>Megel&#337;z√©si m√≥dszerek, amik NEM M&#368;K÷DNEK</h4></div></div></div><p>Titkos cookie haszn√°lata</p><p>Eml√©kezz√ºnk arra, hogy minden cookie &#8211; m√©g a titkosak is &#8211; elk√ºld√©sre ker√ºlnek minden k√©relemmel. Minden azonos√≠t√≥ token elk√ºld√©sre ker√ºl att√≥l f√ºggetlen√ºl, hogy a felhaszn√°l√≥t csal√°ssal vett√©k-e r√° a k√©relem elk√ºld√©s√©re. S&#337;t, a session azonos√≠t√≥kat egyszer&#369;en arra haszn√°lja az alkalmaz√°s t√°rol√≥ja, hogy √∂sszekapcsolja k√©relmet egy bizonyos session objektummal. A session azonos√≠t√≥ nem ellen&#337;rzi, hogy a felhaszn√°l√≥nak sz√°nd√©k√°ban √°llt-e elk√ºldeni a k√©relmet.</p><p>Csak ut√≥lagos k√©relmeket (POST request) fogadunk el</p><p>Az alkalmaz√°sokat √∫gy is fel lehet √©p√≠teni, hogy csak ut√≥lagos k√©relmeket (POST request) fogadjanak el az √ºzleti logika alkalmaz√°sa v√©gett. A t√©vhit az, hogy mivel a t√°mad√≥ nem tud k√°ros hivatkoz√°st √∂sszerakni, √≠gy a CSRF t√°mad√°s nem kivitelezhet&#337;. Sajnos ez a logika nem helyt√°ll√≥. Sz√°mos olyan m√≥dszer van, amivel a t√°mad√≥ tr√ºkk√∂s m√≥don r√°veheti az √°ldozatot, hogy elk√ºldj√∂n egy hamis√≠tott ut√≥lagos k√©relmet, p√©ld√°ul egy egyszer&#369; &#369;rlap form√°j√°ban, ami a behatol√≥ oldal√°n van t√°rolva √©s rejtett √©rt√©keket tartalmaz. Ezt az &#369;rlapot azt√°n a JavaScript k√∂nnyen aktiv√°lhatja, de megteheti ezt az √°ldozat is, aki azt hiszi, hogy az &#369;rlap valami m√°st fog csin√°lni.</p></div><div class="sect3" title="6.13.2.6. P√©LD√°K"><div class="titlepage"><div><div><h4 class="title"><a name="d0e4010"></a>6.13.2.6. 
      
                  <a name="Examples26"></a>P√©LD√°K</h4></div></div></div><div class="sect4" title="6.13.2.6.1. Hogyan m&#369;k√∂dik a t√°mad√°s?"><div class="titlepage"><div><div><h5 class="title"><a name="d0e4015"></a>6.13.2.6.1. 
      
                     <a name="How_does_the_attack_work.3F2"></a>Hogyan m&#369;k√∂dik a t√°mad√°s?</h5></div></div></div><p>Sz√°mos m√≥dja van annak, hogy tr√ºkkel r√°vegy√ºk a felhaszn√°l√≥t, hogy t√∂lts√∂n be vagy k√ºldj√∂n inform√°ci√≥t egy webes alkalmaz√°sb√≥l/ba. A t√°mad√°s kivitelez√©se c√©lj√°b√≥l el&#337;sz√∂r azt kell √°tl√°tnunk, hogyan hozzunk l√©tre olyan k√°ros k√©relmet, amit az √°ldozat v√©gre fog hajtani. Vegy√ºk szem√ºgyre a k√∂vetkez&#337; p√©ld√°t: Aliz 100 doll√°rt szeretne utalni Robinak a bank.com oldalon kereszt√ºl. Az Aliz √°ltal gener√°lt k√©relem nagyj√°b√≥l a k√∂vetkez&#337;k√©ppen fog kin√©zni:</p><pre class="programlisting">
   POST http://bank.com/transfer.do HTTP/1.1
   ...
   ...
   ...
   Content-Length: 19;
   
   acct=BOB&amp;amount=100
            </pre><p>M√°ria azonban √©szreveszi, hogy ugyanaz a webes alkalmaz√°s, a k√∂vetkez&#337; URL param√©terekkel hajtja v√©gre ugyanazt az √°tutal√°st:</p><p>GET http://bank.com/transfer.do?acct=BOB&amp;amount=100 HTTP/1.1</p><p>M√°ria √∫gy d√∂nt, hogy kihaszn√°lja a webes alkalmaz√°s eme gyenge pontj√°t √©s Aliz lesz az √°ldozata. El&#337;sz√∂r is M√°ria megszerkeszti a k√∂vetkez&#337; URL-t, ami √°t fog utalni 100000 doll√°rt Aliz sz√°ml√°j√°r√≥l az √∂v√©re:</p><p>http://bank.com/transfer.do?acct=MARIA&amp;amount=100000</p><p>Most hogy a k√°ros k√©relme elk√©sz√ºlt, M√°ri√°nak tr√ºkkel r√° kell vennie Alizt, hogy elk√ºldje azt. A legalapvet&#337;bb m√≥dja ennek az, hogy k√ºld Aliznak egy HTML e-mailt, ami a k√∂vetkez&#337;ket tartalmazza:</p><p>&lt;a href="http://bank.com/transfer.do?acct=MARIA&amp;amount=100000"&gt;View my Pictures!&lt;/a&gt;</p><p>Felt√©ve, hogy Aliz be van jelentkezve az alkalmaz√°sba, mikor r√°kattint a hivatkoz√°sra, a 100000 doll√°r √°tvitele Aliz sz√°ml√°j√°r√≥l M√°ria sz√°ml√°j√°ra v√©gbe fog menni. Azonban M√°ria azt is tudja, hogy ha Aliz r√°kattint a hivatkoz√°sra, akkor √©szre fogja venni, hogy valamif√©le tranzakci√≥ t√∂rt√©nt. Ez√©rt M√°ria √∫gy d√∂nt, hogy egy 0 b√°jtos k√©pbe rejti a t√°mad√°st:</p><p>&lt;img src="http://bank.com/transfer.do?acct=MARIA&amp;amount=100000" width="1" height="1" border="0"&gt;</p><p>Ha ezt a k√©p tag-et beleteszi az email-be, akkor Aliz csak azt fogja l√°tni, hogy egy kis doboz jelenik meg, mintha a b√∂ng√©sz&#337; nem tudta volna feldolgozni a k√©pet. Azonban a b√∂ng√©sz&#337; ETT&#336;L F‹GGETLEN‹L elk√ºldi a k√©relmet a bank.com oldalnak an√©lk√ºl, hogy a tranzakci√≥nak b√°rmilyen l√°that√≥ jele lett volna.</p><p></p><p></p></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch06s12.html">El&#337;z&#337;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch06.html">Fel</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch07.html">K√∂vetkez&#337;</a></td></tr><tr><td width="40%" align="left" valign="top">6.12. 
      
            &#8222;Szimatol√≥ t√°mad√°s &#8211; H√°l√≥zati Lehallgat√°s&#8221; (Sniffing Attacks - Network Eavesdropping)&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Tartalom</a></td><td width="40%" align="right" valign="top">&nbsp;7. fejezet - Teszt menedzsment</td></tr></table></div></body></html>