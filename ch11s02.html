<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <title>11.2. Server oldal tesztel√©se</title><link rel="stylesheet" href="style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"><link rel="home" href="index.html" title="Szoftvertesztel√©s"><link rel="up" href="ch11.html" title="11. fejezet - Esettanulm√°ny"><link rel="prev" href="ch11.html" title="11. fejezet - Esettanulm√°ny"><link rel="next" href="ch11s03.html" title="11.3. Kliens oldal tesztel√©se"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">11.2. Server oldal tesztel√©se</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch11.html">El&#337;z&#337;</a>&nbsp;</td><th width="60%" align="center">11. fejezet -  Esettanulm√°ny </th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch11s03.html">K√∂vetkez&#337;</a></td></tr></table><hr></div><div class="sect1" title="11.2. Server oldal tesztel√©se"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6311"></a>11.2. Server oldal tesztel√©se</h2></div></div></div><div class="sect2" title="11.2.1. Egys√©gteszt"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6314"></a>11.2.1. Egys√©gteszt</h3></div></div></div><p>Az egys√©gtesztek √≠r√°s√°n√°l k√©t m√≥dszert is k√∂vethet√ºnk a teszt oszt√°lyaink l√©trehoz√°s√°ra:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A tesztelend&#337; szt√°ly mellett l√©trehozunk egy mapp√°t (csomagot) √©s abban helyezz√ºk el a teszt oszt√°lyokat</p></li><li class="listitem"><p>Egy k√ºl√∂n mapp√°ban, ahol k√∂vetj√ºk a tesztelend&#337; oszt√°lyok struktur√°j√°t (uyganaz a csomag egym√°sba √°gyaz√°sa). A Netbeans csak ezt t√°mogatja.</p></li></ol></div><p>Mind az Eclipse, mind a Netbeans t√°mogatja az egys√©g tesztek gener√°l√°s√°t, √©s grafikus fel√ºleten nyomon k√∂vethetj√ºk a tesztek eredm√©ny√©t. Mi a fejelszt√©s alatt a Netbeans haszn√°ltuk, √©s a fejleszt√©s ideje alatt a 6.9.1-es verzi√≥t haszn√°ltuk. A teszt oszt√°lyokat elk√©sz√≠thetj√ºk k√©zzel vagy m√°s alkalmaz√°ssal is ilyenkor m√°soljuk a be egy mapp√°ba az src mappa mell√©. Ha m√©g nem l√©tezik, akkor a Netbeans l√©trehozza a teszt oszt√°lyokat automatikusan. Hozzunk l√©tre egy √∫j f√°jlt! A kateg√≥ri√°k k√∂z√ºl keress√ºk ki a JUnit nev&#369;t, majd v√°laszzunk a lehet&#337;s√©gek k√∂z√ºl: Egy √ºres teszt, amit nek√ºnk kell majd testreszabni, vagy teszt egy l√©tez&#337; oszt√°ly alapj√°n (ilyen az oszt√°ly nyilv√°nos f√ºggv√©nyei alapj√°n elk√©sz√≠t egy teszt oszt√°lyt), vagy egy teszt gy&#369;jtem√©nyt egy csomag oszt√°lyai alapj√°n.</p><div class="figure"><a name="openrmtExtLayers_1"></a><p class="title"><b>11.3. √°bra - Tesztk√©szlet l√©trehoz√°sa Netbeans alatt</b></p><div class="figure-contents"><div align="center"><img src="images/egysegtesztekgeneralasanetbeans.png" align="middle" alt="Tesztk√©szlet l√©trehoz√°sa Netbeans alatt"></div></div></div><p><br class="figure-break">Miut√°n a teszt oszt√°lyok elk√©sz√ºltek t√∂lts√ºk ki azok met√≥dusait. Ne felejts√ºk el, hogy az IDE minden met√≥dushoz csak 1 teszt f√ºggv√©nyt gener√°l, azonban nek√ºnk ez nem el√©g. √°ltal√°ban t√∂bbre van sz√ºks√©g, teszteln√ºk kell pozit√≠v eredm√©nyekre √©s hib√°k helyes kezel√©s√©re is. Az egy tervez√©si d√∂nt√©s, hogy egy hiba keletkez√©s√©n√©l kiv√©telt dobunk vagy visszat√©r√©si √©rt√©kben adjuk vissza sikertelen m&#369;velet t√©ny√©t. </p><div class="tip" title="Tipp" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tipp]" src="https://gyires.inf.unideb.hu/system/docbook-xsl/images/tip.png"></td><th align="left">Tipp</th></tr><tr><td align="left" valign="top"><p>Haszn√°ljuk kiv√©teleket a hib√°s param√©terek, nem megfelel&#337;  k√∂rnyezet jelz√©s√©re, mert ilyenkor lehet&#337;s√©g van visszafejteni a hiba pontos hely√©t, ok√°t!</p></td></tr></table></div><p>
            </p><p>A JUnit seg√≠ts√©gvel figyelhetj√ºk egy kifejez√©s √©rt√©k√©t, kiv√©tel keletkez√©s√©t.</p><p>√©rdemes a teszt√ºnk param√©tereit nem sz√∂vegkonstansokkal megadni, haszn√°ljuk helyette a JVM param√©tereket, mert ilyen kor lehet&#337;s√©g van √∫jraford√≠t√°s n√©lk√ºl futtatni k√ºl√∂nb√∂z&#337; param√©terekkel. Netbeans alatt ezt k√∂nnyen megtehetj√ºk, csak fel kell venni egy √∫j fut√°si konfigur√°ci√≥t (run configuration), melynek neve "test": </p><div class="figure"><a name="openrmtExtLayers_2"></a><p class="title"><b>11.4. √°bra - Egys√©gtesztek gener√°l√°sa Netbeans seg√≠ts√©g√©vel</b></p><div class="figure-contents"><div align="center"><img src="images/testparameternetbeans.png" align="middle" alt="Egys√©gtesztek gener√°l√°sa Netbeans seg√≠ts√©g√©vel"></div></div></div><p><br class="figure-break"> Az aktu√°lis param√©ter el√©r√©se a k√∂vetkez&#337; k√≥ddal lehets√©ges, amelyet √©rdemes a tesztek el&#337;tt egyszer kiolvasni √©s elt√°rolni:
</p><div class="example"><a name="d0e6346"></a><p class="title"><b>11.1. p√©lda - A JUNIT teszt setUp() f√ºggv√©nye, ami kiolvassa a JVM param√©tereket</b></p><div class="example-contents"><pre class="programlisting">@Before public void setUp() throws Exception { 
testComp = System.getProperty("testCompName"); 
}</pre></div></div><p><br class="example-break">

            </p><p>Ha a tesztek elk√©sz√ºltek, akkor futtatsuk azokat! Futtahatunk egy teszt oszt√°ly (Test File, Debug Test File), vagy a projekthez tartoz√≥ √∂sszeset is (Test Project).</p><p>
               </p><div class="figure"><a name="openrmtExtLayers_3"></a><p class="title"><b>11.5. √°bra - Egys√©gteszt eredm√©ny√©nek ablaka Netbeans alatt</b></p><div class="figure-contents"><div align="center"><img src="images/teszteredmenyenetbeans.png" align="middle" alt="Egys√©gteszt eredm√©ny√©nek ablaka Netbeans alatt"></div></div></div><p><br class="figure-break">
            </p></div><div class="sect2" title="11.2.2. Integr√°ci√≥s teszt (Cactus)"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6361"></a>11.2.2. Integr√°ci√≥s teszt (Cactus)</h3></div></div></div><p>A Java alap√∫ webalkalmaz√°sok tesztel√©se k√∂nnyen elv√©gezhet&#337; a Cactus (Apache) term√©kkel, amely hat√©kony keretrendszer az integr√°ci√≥s egys√©gtesztek futtat√°s√°ra. Az egys√©gteszt elln√∂rzi az egyes objektumok helyes m&#369;k√∂d√©s√©t, de nem ellen√∂rzi az objektumok k√∂z√∂tti helyes kapcsolatokat. A redndszer a megfelel&#337;en egy√ºttm&#369;k√∂d&#337; objektumok alkotj√°k, √≠gy tesztel√©s√ºk fontos. A Cactus rendszer fontos tulajdons√°ga, hogy a tesztelend&#337; elemek (szervlet, EJB, ...) a val√≥s√°gos kont√©nerben futnak. L√©teznek mock objektumok is az integr√°ci√≥s tesztekre. B√°r a Cactus bizonyosan lassab, de val√≥s√°gos, t√©nyleges (vagy ahhoz nagyon k√∂zeli)  k√∂rnyezetben ellen&#337;rizhetj√ºk seg√≠ts√©g√©vel r√©sz rendszereineket. A mock teszttel ellent√©tben tudjuk ellen&#337;rizni az √©letciklust, biztons√°got, tranzakci√≥t, perzisztenci√°t, stb. . </p><p>A keretrendszer Ecosystem-et defini√°l, amely h√°rom f√©le komponenst haszn√°l: Cactus keretrendszer,Cactus integr√°ci√≥s modulok, Cactus mint√°k, melyet a k√∂vetkez&#337; √°bra illusztr√°l:</p><div class="figure"><a name="openrmtExtLayers_6"></a><p class="title"><b>11.6. √°bra - Cactus Ecosystem fel√©p√≠t√©s</b></p><div class="figure-contents"><div align="center"><img src="images/ecosystem.jpg" align="middle" alt="Cactus Ecosystem fel√©p√≠t√©s"></div></div></div><p><br class="figure-break">
            </p><p>Telep√≠t√©se egyszer&#369;, csak a jar file-okat kell a megfelel&#337; helyre m√°solni. A grafikus fel√ºletr&#337;l az IDE gondoskodik, √©s a CI rendszer√ºkben karakteresen futva sz√∂vegesen gy&#369;lnek a teszt esetek. Mivel itt a teszt esetek a szerver oldalon futnak, ez√©rt egy kicsit speci√°lis a haszn√°latuk. N√©zz√ºk √°t a haszn√°lati esetek k√©sz√≠t√©s√©t! Alapvet&#337;en k√©t lehet&#337;s√©g van teszt futtatni √≠rni:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A Cactus teszt esetek oszt√°lyait haszn√°lva, melyek ServletTestCase  a szervlet API  (HttpServletRequest, HttpServletResponse, HttpSession, ServletConfig, ServletContext, ...), JspTestCase a JSP API  (PageContext, JspWriter, ...) √©s a FilterTestCase a Filter API objektumainak ellen&#337;rz√©s√©re  (FilterChain, FilterConfig, HttpServletRequest, HttpServletResponse, ...), amiket t√©nylegesen servletk√©nt, vagy filterk√©nt, futtatunk a webalkalmaz√°s motoron.</p></li><li class="listitem"><p>Hagyom√°nyos JUnit teszt eseteket haszn√°lunk, ami egy Cactus teszt k√©szletet haszn√°l ServletTestSuite. Parancssor√≥l futtatjuk.</p></li></ol></div><p>A keretrendszer kliens-szerver alap√∫. A k√∂vetkez&#337;keben az xxx a teszt neve minden esetben, azaz ha van egy LoginOk nev&#369; teszt eset, akkor ehhez defini√°lhatunk beginLoginOk(), endLoginOk() √©s testLoginOk() met√≥dusokat. Vannak met√≥dusok amelyek a kliens oldalon futnak (beginxxx(), endxxx()) majd l√©trehozva egy proxy objektumot az el&#337;z&#337;leg telep√≠tett szerver szervlet-hez kapcsol√≥dva lefuttatj√°k a szerver oldali met√≥dusokat a szerver oldalon (setUp(), testxxx(), tearDown()). Egy webalkalmaz√°s funkci√≥j√°nak lehetnek ut√≥hat√°sai a szerver √©s a kliens oldalon is, melyeket a rendszer seg√≠ts√©g√©vel ellen&#337;rizhet√ºnk. A szerver oldali ut√≥hat√°sok ellen√∂rz√©s√©re a k√≥dot a testxxx() met√≥dusba kell √≠rnunk, a kliens oldali v√°lasz ellen&#337;rz√©s√©re pedig ott van az endxxx() met√≥dus.</p><p>B√°rmelyik futtat√°si m√≥dot v√°lasztjuk a szerver oldalon mindenk√©ppen telep√≠ten√ºnk kell neh√°ny komponenst. Mi Apache Tomcat rednszert haszn√°ltuk, a be√°ll√≠t√°sokat n√©zz√ºk meg erre az esetre. Jelen pillanatban a Cactus 1.8.1-es verzi√≥ja √©rhet&#337; el, √©s az interneten el√©rhet&#337; dokument√°ci√≥a f√ºgg&#337;s√©gekr&#337;l egy r√©gebbi verzi√≥t ismertet. B√°rmilyen java rendszer is telep√≠t√ºnk haszn√°lat k√∂zben az oszt√°ly bet√∂lt&#337; jelzi, hogy ha valamely oszt√°ly nem tal√°lhat√≥. Ennek k√©t oka lehet: vagy nincs egy jar f√°jl a classpath helyen, vagy valamelyik jar f√°jlb√≥l egy r√©gebbi verzi√≥t haszn√°lunk. </p><p>Els&#337; l√©p√©sk√©nt m√°soljuk a megfelel&#337; helyre a Cactus jar f√°jljait! K√©t lehet&#337;s√©g van: vagy a tomcat lib mapp√°j√°ba m√°soljuk, vagy c√©lzottan a tesztelend&#337; webalkalmaz√°s WEB-INF/lib mapp√°ba. Az els&#337; megold√°s hat√©konyabb, hiszen egy √∫jabb tesztelend&#337; webalkalmaz√°s eset√©n √∫jb√≥l telep√≠teni kell, ami plusz mnunka √©s √∫jabb helyfoglal√°s a h√°tt√©rt√°rol√≥n. M√°soland√≥ jar f√°jlok: cactus.core.xxx, commons.codecxxx, commons.httpclientxxx, commons.loggingxxx, aspectjrt.jar, junitxxx (xxx att√≥l f√ºggmelyik verzi√≥t haszn√°ljuk). Ezut√°n m√≥dos√≠tsuk a /conf/web.xml konfigur√°ci√≥s √°llom√°nyt!</p><div class="tip" title="Tipp" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tipp]" src="https://gyires.inf.unideb.hu/system/docbook-xsl/images/tip.png"></td><th align="left">Tipp</th></tr><tr><td align="left" valign="top"><p>Ha m√≥dos√≠tani akarjuk valamely rendszer konfigur√°ci√≥s √°llom√°ny√°t, akkor minden m√≥dos√≠t√°s el&#337;tt ments√ºk el azt valamilyen kiterjeszt√©ssel, pl. egy d√°tum ut√≥taggal eg√©sz√≠ts√ºk ki. A f√°jl tartalm√°ban is √≠rjuk be megjegyz√©sk√©nt, hogy ki mi√©rt m√≥dos√≠tott. </p></td></tr></table></div><p>√≠rjuk be a k√∂vetkez&#337; bejegyz√©st a web-app bejegyz√©s elej√©re, azaz a &lt;web-app ....&gt; kedet&#369; sor ut√°n:</p><div class="example"><a name="d0e6391"></a><p class="title"><b>11.2. p√©lda - Cactus szervletek be√°ll√≠t√°sa Tomcat rendszerbe</b></p><div class="example-contents"><pre class="programlisting">&lt;servlet&gt;
  &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.apache.cactus.server.ServletTestRedirector&lt;/servlet-class&gt;
  <a name="init"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/1.png" alt="1" border="0">&lt;init-param&gt;
    &lt;param-name&gt;param1&lt;/param-name&gt;
    &lt;param-value&gt;value1 used for testing&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/servlet&gt;

&lt;servlet&gt;
  &lt;servlet-name&gt;ServletTestRunner&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.apache.cactus.server.runner.ServletTestRunner&lt;/servlet-class&gt;
&lt;/servlet&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#init"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/1.png" alt="1" border="0"></a> </p></td><td valign="top" align="left"><p>Nem k√∂telez&#337;, ezzel a m√≥dszerrel lehet param√©tereknek √©rt√©ket megadni.</p></td></tr></table></div></div></div><p><br class="example-break">A konfigur√°ci√≥s √°llom√°nyban sz√°mos ilyen szervlet bejegyz√©s tal√°lhat√≥, ahol megadjuk a szervlet nev√©t, √©s az azt implement√°l√≥ oszt√°ly teljes nev√©t. Ezut√°n meg kell adni ennek a szervletnek az url mint√°j√°t, holy milyen k√©r√©s hat√°s√°ra  t√∂ltse be a kont√©ner, melyet a k√∂vetkez&#337; k√≥d defini√°l:</p><div class="example"><a name="d0e6403"></a><p class="title"><b>11.3. p√©lda - Cactus szervletek be√°ll√≠t√°sa Tomcat rendszerbe</b></p><div class="example-contents"><pre class="programlisting">&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ServletRedirector&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ServletRedirector&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;ServletTestRunner&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ServletTestRunner&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
  &lt;servlet-class&gt;org.apache.cactus.server.runner.ServletTestRunner&lt;/servlet-class&gt;
&lt;/servlet&gt;</pre></div></div><p><br class="example-break"> Az √°llom√°nyban m√°r vannak ilyen bejegyz√©sek, helyezz√ºk ezt a t√∂bbi hasonl√≥ el√©!</p><p>Ugyan√∫gy defini√°lhatunk setUp √©s tearDown met√≥dusokat, de ezek imm√°ron a szerver oldalon futnak, √≠gy el√©rik a szerver √©s a Cactus implicit objektumokat is. A teszt f√ºggv√©nyekben testXXX() p√©ld√°nyos√≠tjuk a szerveletet (vagy m√°s szerver oldali objektumot), haszn√°ljuk azt, majd ellen&#337;rizz√ºk a szokott m√≥don az asserts(), assertEquals() met√≥dusokkal vagy a fail() met√≥dussal hib√°t jelz√ºnk. A Cactus rendszerben lehet&#337;s√©g van minden testXXX() met√≥dushoz beginXXX() √©s endXXX() met√≥dusokat defini√°lni, amelyek csak az adott teszt f√ºggv√©ny el&#337;tt (ut√°n) futnak le. (Eml√©kezz√ºnk vissza. A setUp √©s tearDown minden teszt met√≥dus el&#337;tt lefut r√°ad√°sul a szerver oldalon.) A beginXXX(WebRequest theRequest) met√≥dus param√©tere egy Cactus objektum, amit be√°ll√≠thatunk a t√©nyleges k√©r√©snek megfelel&#337;en, amely f√ºggv√©ny "kliens" oldalon fut, miel&#337;tt a testXXX lefutna. A teszt ut√°ni f√ºggv√©ny szint√©n a "kliens" oldalon fut le (ha a aszerver oldalon nem volt hiba, √©s minden ellen√∂rz√©s sikeresen lefutott), feladata a v√°lasz ellen√∂rz√©se endXXX(). A Cactus egy proxy objektumon kereszt√ºl tov√°bbitja a k√©r√©st a szerver oldali logik√°j√°nak, majd ha lefutott vissza t√©r a kliens oldalra. A pontos foylamatot a k√∂vetkez&#337; √°br√°n l√°thatjuk:</p><div class="figure"><a name="openrmtExtLayers_7"></a><p class="title"><b>11.7. √°bra - Cactus tesz met√≥dus futtat√°s√°nak folyamata</b></p><div class="figure-contents"><div align="center"><img src="images/cactus_archi.jpg" align="middle" alt="Cactus tesz met√≥dus futtat√°s√°nak folyamata"></div></div></div><p><br class="figure-break">
            </p><p>A Cactus-ban haszn√°lhatjuk a m√°r megszokott  implicit objektumokat (publikus adattag form√°j√°ban). Ezek egy r√©sze  csak a szerver oldalon l√©tezik, m√°sok kliens oldalon is el√©rhet&#337;ek. Csak szerver oldali implicit objektumok a session,ServletContextWrapper,config. Ezek haszn√°lhat√≥ak a setUp(), a testXXX() √©s a tearDown() met√≥dusokban (nem haszn√°lhatjuk a kliens oldali fv.-ekben, mert ott √©rt√©k√ºk null). Kliens oldalon is haszn√°lhat√≥ak a request (beginXXX), response (endXXX). ÷sszegezve 5 objektum l√©tezik, melyek a k√∂vetkez&#337;ek:</p><div class="variablelist"><dl><dt><span class="term">request</span></dt><dd><p>Saj√°t wrapper oszt√°ly, ami a megszokott HttpServletRequest oszt√°lyb√≥l sz√°rmazik. √°llatl√°ban a beginXXX() met√≥dusban haszn√°ljuk, hogy be√°ll√≠tsuk a teszt k√©r√©s param√©tereit, √©s a s√ºti(ke)t. N√©h√°ny met√≥dussal rendelkezik, ami nincs a hagyom√°nyos k√©r√©s objektumban, ezek a tesztel√©s param√©tereinek a be√°ll√≠t√°s√°t szolg√°lj√°k: setRemoteIPAddress(), setRemoteHostName(), setRemoteUser(), setMethod().</p></dd><dt><span class="term">response</span></dt><dd><p>Ez a megszokott HttpServletResponse oszt√°ly egy p√©ld√°nya.</p></dd><dt><span class="term">config</span></dt><dd><p>Saj√°t wrapper oszt√°ly, ami a megszokott ServletConfig oszt√°lyb√≥l sz√°rmazik. Lehet&#337;s√©get biztos√≠t, hogy inicializ√°l√≥ param√©tereket adjuk meg a szervletnek web.xml n√©lk√ºl. Haszn√°lhat√≥ defini√°lt plusz met√≥dusok: setInitParameter(), setServletName()</p></dd><dt><span class="term">ServletContextWrapper</span></dt><dd><p>Nem √©rhet&#337; el k√∂zvetlen√ºl, de ugyan√∫gy l√©trej√∂n √©s haszn√°lata javasolt. A config.getServletContext() met√≥dus visszat√©r√©si √©rt√©ke</p></dd><dt><span class="term">session</span></dt><dd><p>A rendszer v√°ltozatlan form√°ban el√©rhet&#337;v√© teszi (inicializ√°lja) a megszokott objektumot. A teszt f√ºggv√©nyben a szok√°sos m√≥don haszn√°lhatjuk, majd ellen&#337;rizhetj√ºk a tartalm√°t.</p></dd></dl></div><p>

              
            </p><p>N√©zz√ºnk meg egy k√≥dr√©szletet a  ManagerServlet-√ºnk tesztel√©s√©t v√©gz&#337; TesztManagerServlet oszt√°lyb√≥l: </p><div class="example"><a name="d0e6452"></a><p class="title"><b>11.4. p√©lda - Cactus servlet teszt eset oszt√°ly (r√©szlet)</b></p><div class="example-contents"><pre class="programlisting">    public void beginLogOut(<a name="webRequest"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/1.png" alt="1" border="0">WebRequest webRequest)
    {

        <a name="addParameter"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/2.png" alt="2" border="0">webRequest.addParameter("function", "logout");
    }

    public void testLogOut()
    {

        <a name="createServlet"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/3.png" alt="3" border="0">ManagerServlet servlet = new ManagerServlet();
        try{
            <a name="callFunction"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/4.png" alt="4" border="0">servlet.processRequest(request, response);
        }catch(Exception ex)
        {
            <a name="failServletException"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/5.png" alt="5" border="0">fail("Exception occured: " + ex.getMessage());
        }


       <a name="assertSession"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/6.png" alt="6" border="0">assertFalse("Session is exist yet", request.isRequestedSessionIdValid());

    }

    public void endLogOut(<a name="theResponse"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/7.png" alt="7" border="0">WebResponse theResponse)
    {
        try {

   // XML feldolgozas helye

    NodeList nodes = (NodeList) result;

    assertEquals("XML is not correct ", 1, nodes.getLength());

   String response =  nodes.item(0).getNodeValue();

    <a name="response"></a><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/8.png" alt="8" border="0">assertEquals("wrong resultCode", "0", response);


        } catch (Exception ex) {
            Logger.getLogger(TestManagerServlet.class.getName()).log(Level.SEVERE, null, ex);
        }

    }
</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#webRequest"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/1.png" alt="1" border="0"></a> </p></td><td valign="top" align="left"><p>Kliens oldalon a kapott param√©ter haszn√°lhatjuk, a k√©r√©s be√°ll√≠t√°s√°ra.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#addParameter"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/2.png" alt="2" border="0"></a> </p></td><td valign="top" align="left"><p>Be√°ll√≠tjuk a k√©r√©s param√©ter√©t, jelen esetben function param√©tert logout √©rt√©kre.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#createServlet"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/3.png" alt="3" border="0"></a> </p></td><td valign="top" align="left"><p>A teszt f√ºggv√©nyben l√©trehozzuk a k√≠v√°nt szervletet.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#callFunction"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/4.png" alt="4" border="0"></a> </p></td><td valign="top" align="left"><p>Megh√≠vjuk a tesztelend&#337; met√≥dust.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#failServletException"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/5.png" alt="5" border="0"></a> </p></td><td valign="top" align="left"><p>Ha b√°rmi kiv√©tel keletkezik, akkor a teszt sikertelen (musz√°ly kezeln√ºnk). </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#assertSession"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/6.png" alt="6" border="0"></a> </p></td><td valign="top" align="left"><p>Ellen&#337;rizz√ºk a szerver oldali k√≠v√°nt ut√≥hat√°st. Jelen esetben a kijelentkez√©s funkci√≥t√≥l elv√°rjuk, hogy √©rv√©nytelen√≠tse a session-t.</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#theResponse"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/7.png" alt="7" border="0"></a> </p></td><td valign="top" align="left"><p>Az endxxx() kliens oldali f√ºggv√©ny egyetlen param√©tere a kapott v√°lasz (tartalom, v√°laszk√≥d, s√ºti,...)</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="ch11s02.html#response"><img src="https://gyires.inf.unideb.hu/KMITT/c12/images/callouts/8.png" alt="8" border="0"></a> </p></td><td valign="top" align="left"><p>A kliens oldalon ellen&#337;rizhetj√ºk a kapott tartalmat. Jelen esetben egy XML, aminek tartalmazni kell egy response tagot, aminek az √©rt√©ke 0 kell legyen. (Az XML feldolgoz√°s t√∂bb utas√≠t√°sb√≥l √°ll, t√∂bb lehet&#337;s√©g is van.)</p></td></tr></table></div></div></div><p><br class="example-break">
            </p><p>A tesztek futtat√°s√°ra k√©t lehet&#337;s√©g is k√≠n√°lkozik. Futtathatjuk egy m√°sik servlet form√°j√°ban, vagy JUnit tesztbe √°gyazva (jelen pillanatban a JUnit 4-es nem t√°mogatott). 
Szervletk√©nt futtatva haszn√°lnunk kell a telep√≠tett redirector szervletet megadva neki a teszt oszt√°lyunk teljes nev√©t. A v√°lasz XML form√°tum√∫, de a Cactus oldal√°r√≥l let√∂lthet√ºnk egy 
xls f√°jlt hozz√°, √≠gy kimenet html sz√∂veg lesz. Miut√°n elhelyezt√ºk a webalakalmaz√°s gy√∂ker√©be a let√∂lt√∂tt xsl-t a k√©r√©s a mi eset√ºnkben a k√∂vetkez&#337;k√©ppen n√©z ki:
</p><div class="example"><a name="d0e6501"></a><p class="title"><b>11.5. p√©lda - Cactus szervlet teszt futtat√°sa</b></p><div class="example-contents"><pre class="programlisting">http://localhost:8080/ServletTestRunner?suite=hu.sztaki.openrtmext.server.servlets.TestManagerServlet&amp;xsl=cactus-report.xsl</pre></div></div><p><br class="example-break">
Mely hat√°s√°ra hasonl√≥ az eredm√©ny tartalmazza egy √∂sszes√≠t√©st, √©s hiba vagy rossz eredm√©ny eset√©n a hely√©t, le√≠r√°s√°t. A k√©r√©s kimenete a mi eset√ºnkben egy hiba eset√©n a k√∂vetkez&#337; k√©ppen n√©z ki: 

</p><div class="figure"><a name="openrmtExtLayers_8"></a><p class="title"><b>11.8. √°bra - Cactus szervlet teszt√ºnk eredm√©nye a b√∂ng√©sz&#337;ben</b></p><div class="figure-contents"><div align="center"><img src="images/cactustesteredmenyek.png" align="middle" alt="Cactus szervlet teszt√ºnk eredm√©nye a b√∂ng√©sz&#337;ben"></div></div></div><p><br class="figure-break">
            </p><p>Paransorb√≥l vagy Netbeans al√≥l futtatva (Shift + F6) az el&#337;z&#337; k√≥dot ki kell eg√©sz√≠ten√ºnk egy main f√ºggv√©nnyel: </p><div class="example"><a name="d0e6514"></a><p class="title"><b>11.6. p√©lda - Cactus teszt futtat√°sa futtathat√≥ alkalmaz√°s form√°j√°ban</b></p><div class="example-contents"><pre class="programlisting">    public static void main(String[] args) {
        junit.textui.TestRunner.run(suite());
    }</pre></div></div><p><br class="example-break">A fenti k√≥don k√≠v√ºl be√°ll√≠thatjuk a Cactus param√©tereit, amib&#337;l egy k√∂telez&#337;, √©s nincs alap√©rtelemezett √©ert√©ke. A Be√°ll√≠sra t√∂bb lehet&#337;s√©g √©s k√≠n√°lkozik: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>JVM param√©terrel -Dparamn√©v=√©rt√©k</p></li><li class="listitem"><p>Konfigur√°ci√≥s f√°jlban, melynek neve <span class="italic">cactus.properties</span>, aminek a classpath-ban kell lennie. √°tdefini√°lhat√≥ a n√©v a -Dcactus.config=c:/cactus.txt JVM param√©ter seg√≠ts√©g√©vel.</p></li><li class="listitem"><p>A teszt k√≥dban a megfelel&#337; rendszer v√°ltoz√≥ √°ll√≠t√°s√°val <span class="italic">System.setProperty() </span>
                     </p></li></ol></div><p>
            </p><p>Ilyenkor a kimenetre √≠rja a teszt eredm√©nyeket. Alap√©rtelmezett a besz√©des m√≥d (ALL), √≠gy minden akci√≥t ki√≠r a kimenetre (kapcsol√≥dva a szerver oldalhoz, milyen k√©r√©st k√ºl el, milyen param√©tert √°ll√≠t be, ...). </p></div><div class="sect2" title="11.2.3. Jmeter teljes√≠tm√©ny teszt"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6539"></a>11.2.3. Jmeter teljes√≠tm√©ny teszt</h3></div></div></div><p>A webalkalmaz√°sunk teljes√≠tm√©ny tesztel√©s√©t a rendszer strukt√∫r√°j√°nak, √©s m&#369;k√∂d√©s√©nek tudat√°ban kezdj√ºk el. Az alkalmaz√°ssal szemben t√°masztott f&#337; k√∂vetelm√©ny a helyes m&#369;k√∂d√©s, ut√≥hat√°s. A m√°sodlagos k√∂vetelm√©ny a megfelel&#337; (haszn√°lhat√≥) v√°laszid&#337;. Norm√°l k√©r√©seket 1-2 m√°sodperc, egyes k√©r√©seket maximum 5-8 m√°sodperc alatt ki kell szolg√°lni. Term√©szetesen a felhaszn√°l√≥i k√©zik√∂nyvben jelezni kell az esetleges nagy v√°laszid&#337;ket, √©s azt, hogy a v√°laszid&#337; minek a f√ºggv√©nye.</p><p>Ebben az alkalmaz√°sban a rekurz√≠v v√©grehajt√°st ig√©nyl&#337; funkci√≥k f√°lasuideje lehet nagy. Erre a tervez√©s sor√°n m√°r gondoltunk, ez√©rt ezek sz√°lban futnak, √©s a haszn√°lt k√ºls&#337; elemek v√°laszidej√©t is kicsire √°ll√≠tottuk. A rendszer√ºnk CORBA objektumokat haszn√°l, √©s minden rekurz√≠v fut√°st ig√©nyl&#337; m&#369;velet az √©ppen aktu√°lis fa m√©ret√©t&#337;l er&#337;sen f√ºgg. A CORBA objektumok v√°laszideje alacsony kell legyen. Ink√°bb Zombie-nak nyilv√°n√≠tjuk, mintsem megn√∂velje drasztikusan a v√°laszid&#337;t. Norm√°l esetben a rendszert 10-20 felhaszn√°l√≥ fogja haszn√°lni egyszerre, mi azonban 100 felhaszn√°l√≥t fogunk szimul√°lni. √°ltal√°ban az egyidej&#369; felhaszn√°l√≥k sz√°ma hat√°rozza meg a v√°laszid&#337;t, ami a mi eset√ºnkben is igaz, hiszen minden k√©r√©s kiszolg√°l√°s egy √∫j sz√°lat √≠nd√≠t el a szerver oldalon. A szervletek ebben az √∫j sz√°lban futnak. Figyelj√ºk oda ez√©rt a glob√°lis jelleg&#369; adatok haszn√°latakor, hogy sz√°lbiztos legyen. A Jmeter seg√≠ts√©g√©vel t√∂bb - helyben elosztott - k√©r√©st is tudunk k√ºldeni, hogy minn√©l re√°lisabb teszt eredm√©nyeket kapjunk. Els&#337; l√©p√©sk√©nt csak egy bizonyos er&#337;forr√°st (funkci√≥t) k√©r√ºnk ciklikusan (ilyenkor √©rdemes a szerver oldalon a mem√≥ria sziv√°rg√°st is figyelni). Majd emelj√ºk a p√°rhuzamos sz√°lak sz√°m√°t, √©s az ism√©tl√©seket. √©rdemes extr√©m helyzeteket is el&#337;√°ll√≠tani, hogy megfigyelj√ºk a rendszer hibat&#369;r√©si k√©pess√©g√©t √©s hat√°rait.</p></div><div class="sect2" title="11.2.4. Hudson rendszer"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6546"></a>11.2.4. Hudson rendszer</h3></div></div></div><p>A Hudson rendszer nem teszt alkalmaz√°s, hanem folyamatos integr√°ci√≥s alkalmaz√°s, ami ebben az esetben egy webalkalmaz√°s. Seg√≠ts√©g√©vel automatiz√°ltan lehet projektjeink k√©sz term√©k√©t (artifact) el&#337;√°ll√≠tani √©s k√∂z√∂s helyen t√°rolni. A v√©gterm√©k lehet egy programoz√≥ k√∂nyvt√°r (lib vagy jar), lehet egy alkalmaz√°s, dokument√°ci√≥ vagy b√°rmi ami a projekt kimenete lehet. Alapvet&#337;en java projektek menedzsel√©s√©re hozt√°k l√©tre, de b√°rmilyen nyelv&#369; projkre be√°ll√≠that√≥ testte szabhat√≥. A rendszer a k√∂vetkez&#337; szolg√°ltat√°sokat ny√∫jtja:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Automatikus ford√≠t√°s, l√©trehoz√°s. A rendszer lehet&#337;v√© teszi, hogy sz√ºks√©g eset√©n megpr&#337;b√°lja l√©trehozni a term√©ket ak√°r osztottan is. (Ant √©s maven t√°mogatott, de b√°rmilyen k√ºls&#337; alkalmaz√°st meg tud h√≠vni.) </p></li><li class="listitem"><p>Teszt esetek futtat√°sa ford√≠t√°s ut√°n. Ford√≠t√°s ut√°n lefuttatja a k√≠v√°nt teszteket, amelyekr&#337;l kimutat√°s is k√©sz√≠t k√©r√©sre, jelenleg JUnit/TestNG riportokat t√°mogat.</p></li><li class="listitem"><p>Biztos√≠tja a felhaszn√°l√≥kat, hogy mindenki ugyanazt a v√©gterm√©et haszn√°lja. Defini√°l URL-t a term√©k let√∂lt√©s√©re, ha mindenki azt haszn√°lja, akkot garnt√°lt, hogy nem keringenek k√ºl√∂nb√∂z&#337; verzi√≥k a rendszerben.</p></li><li class="listitem"><p>Automatikus telep√≠t√©s. Ha a k√©sz√≠t√©s menete sikeres volt, akkor a k√©sz alkalmaz√°st telep√≠thetj√ºk v√©gleges hely√©re.</p></li><li class="listitem"><p>Felhaszn√°l√≥ menedzsment, jogok, jogk√∂r√∂k. A rendszerben felhaszn√°l√≥kat hozhatunk l√©tre, majd defini√°lhatjuk, hogy melyik projekten milyen m&#369;veleteket hajthat v√©gre. Ezzel hangolhatjuk rendszer√ºnk m&#369;k√∂d√©s√©t.</p></li><li class="listitem"><p>Lehet&#337;s√©get ny√∫jt, hogy a r√©gebbi verzi√≥kat is let√∂lthess√ºk. Be√°ll√≠that√≥, hogy h√°ny (utols√≥ valamennyi) vagy meddig (adott d√°tumig) verzi√≥t tartson meg a rendszer. Ezek a verzi√≥k b√°rmikor let√∂lthet&#337;ek, k√©sz√≠t√©s√ºk menete (log f√°jlok), teszt eredm√©nyek megtekinthet&#337;ek.</p></li><li class="listitem"><p>Automatikus verzi√≥k√∂vet&#337; rendszer figyel√©s. A rendszernek frissnek kell lennie. Erre k√©t megold√°s ad√≥dik:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>A verzi√≥ k√∂vet&#337; kezdem√©nyezi a term√©k k√©sz√≠t√©s√©nek folyamat√°t. Svn eset√©n a commit hook szriptbe be√≠rhatjuk, hogy k√©rje meg a webalakalmaz√°st a friss verzi√≥ leszed√©s√©re, majd a term√©k el&#337;√°ll√≠t√°s√°ra (wget vagy curl alkalmaz√°sok seg√≠ts√©g√©vel).</p></li><li class="listitem"><p>A Hudson figyeli id&#337;r&#337;l id&#337;re az verzi√≥ k√∂vet&#337;t, hogy t√∂rt√©nt e v√°ltoz√°s. Crontab szer&#369;en meg lehet adni egy kifejez√©st, amelyt&#337;l f√ºgg&#337;en a rendszer fogyeli a verzi√≥ k√∂vet&#337;t, √©s ha √∫j verzi√≥t √©szlel, akkor lehozza, majd elk√©sz√≠ti a term√©ket.</p></li></ol></div><p>
                     </p></li><li class="listitem"><p>Lev√©l/IM √ºzenet k√ºld√©s sikeres/sikertelen ford√≠t√°s eset√©n, RSS t√°rmogat√°s</p></li><li class="listitem"><p>Kompakt, nincs sz√ºks√©g h√°tt√©r adatb√°zisra.</p></li><li class="listitem"><p>Sz√°mos plugin, amely seg√≠ti munk√°nkat.</p></li></ul></div><p> 
            </p><p>A redszer t√∂bb fajta projektet ismer, sz√°munkra a legk√©nyelmesebb a szabad st√≠lus√∫ ( "Build a free-style software project") volt.  A projekt l√©trehoz√°s√°nak menete a k√∂vetkez&#337;:
</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Projekt f&#337; param√©tereinek a megad√°sa. Itt els&#337;sorban a prokjekt nev√©t kell megadni.</p></li><li class="listitem"><p>SCM (Source Code Management) param√©terek be√°ll√≠t√°sa. Mi svn-t haszn√°ltunk, amihez be√©p√≠tett pluginja van a rendszernek. Mivel az svn t√°rol√≥ is ugyanazon a g√©pen volt, √≠gy f√°jl szinten √©rt√ºk el a t√°rol√≥t. </p></li><li class="listitem"><p>Term√©k el&#337;√°ll√≠t√°s√°nak megad√°sa. Itt adjuk meg a term√©k el&#337;√°ll√≠t√°s√°nak pontos menet√©t. Mivel projekt√ºnk ant alap√∫ (Netbeans ant-ot haszn√°l), amit a Hudson-ba √©p√≠tett plugin t√°mogat.</p></li><li class="listitem"><p>Egy√©b kis√©r&#369; m&#369;veletek param√©tereinek a megad√°sa.</p></li><li class="listitem"><p>√©rtes√≠t√©sek defini√°l√°sa, azok param√©tereinek a be√°ll√≠t√°sa.</p></li></ol></div><p>
            </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch11.html">El&#337;z&#337;</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch11.html">Fel</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch11s03.html">K√∂vetkez&#337;</a></td></tr><tr><td width="40%" align="left" valign="top">11. fejezet -  Esettanulm√°ny &nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Tartalom</a></td><td width="40%" align="right" valign="top">&nbsp;11.3. Kliens oldal tesztel√©se</td></tr></table></div></body></html>